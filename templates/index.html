<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Ransomware Monitor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Anti-Ransomware File Monitor</h1>
            <p>Real-time File Integrity Detection using SHA-256</p>
        </div>
        
        <div class="setup-section">
            <h2>Setup & Controls</h2>
            <div class="form-group">
                <label>Directory to Monitor:</label>
                <input type="text" id="directoryInput" placeholder="e.g., ./documents or C:\\Users\\YourName\\Documents">
            </div>
            
            <div class="form-group">
                <label>Scan Interval (seconds):</label>
                <input type="number" id="intervalInput" value="5" min="1" max="60">
            </div>
            
            <div>
                <button class="btn btn-primary" onclick="setDirectory()">Set Directory</button>
                <button class="btn btn-success" onclick="createBaseline()">Create Baseline</button>
                <button class="btn btn-warning" onclick="singleScan()">Single Scan</button>
                <button class="btn btn-success" id="startBtn" onclick="startMonitoring()">Start Monitoring</button>
                <button class="btn btn-danger" id="stopBtn" onclick="stopMonitoring()" style="display:none;">Stop Monitoring</button>
                <span class="monitoring-status inactive" id="monitoringStatus">Inactive</span>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card blue">
                <h3>Total Files</h3>
                <div class="value" id="totalFiles">0</div>
            </div>
            <div class="stat-card green">
                <h3>Secure</h3>
                <div class="value" id="unchangedFiles">0</div>
            </div>
            <div class="stat-card red">
                <h3>Modified</h3>
                <div class="value" id="modifiedFiles">0</div>
            </div>
            <div class="stat-card yellow">
                <h3>New Files</h3>
                <div class="value" id="newFiles">0</div>
            </div>
            <div class="stat-card gray">
                <h3>Deleted</h3>
                <div class="value" id="deletedFiles">0</div>
            </div>
        </div>
        
        <div class="content-grid">
            <div class="panel">
                <h2>üìÅ Monitored Files (<span id="fileCount">0</span>)</h2>
                <div class="file-list" id="fileList">
                    <p style="color: #94a3b8; text-align: center; padding: 40px;">
                        Set a directory and create a baseline to start monitoring
                    </p>
                </div>
            </div>
            
            <div class="panel">
                <h2>‚ö†Ô∏è Security Alerts (<span id="alertCount">0</span>)</h2>
                <div class="alert-list" id="alertList">
                    <p style="color: #94a3b8; text-align: center; padding: 40px;">
                        No alerts yet
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let updateInterval;
        
        async function setDirectory() {
            const directory = document.getElementById('directoryInput').value;
            if (!directory) {
                alert('Please enter a directory path');
                return;
            }
            
            const response = await fetch('/api/set-directory', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({directory})
            });
            
            const result = await response.json();
            if (result.success) {
                alert('Directory set successfully!');
            } else {
                alert('Error: ' + result.error);
            }
        }
        
        async function createBaseline() {
            const response = await fetch('/api/create-baseline', {method: 'POST'});
            const result = await response.json();
            if (result.success) {
                alert('Baseline created successfully!');
                updateData();
            } else {
                alert('Error: ' + result.error);
            }
        }
        
        async function singleScan() {
            const response = await fetch('/api/scan', {method: 'POST'});
            const result = await response.json();
            if (result.success) {
                updateData();
            } else {
                alert('Error: ' + result.error);
            }
        }
        
        async function startMonitoring() {
            const interval = document.getElementById('intervalInput').value;
            const response = await fetch('/api/start-monitoring', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({interval: parseInt(interval)})
            });
            
            const result = await response.json();
            if (result.success) {
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('stopBtn').style.display = 'inline-block';
                document.getElementById('monitoringStatus').textContent = 'Active';
                document.getElementById('monitoringStatus').className = 'monitoring-status active';
                
                // Start auto-updating data
                updateInterval = setInterval(updateData, 2000);
            }
        }
        
        async function stopMonitoring() {
            const response = await fetch('/api/stop-monitoring', {method: 'POST'});
            const result = await response.json();
            if (result.success) {
                document.getElementById('startBtn').style.display = 'inline-block';
                document.getElementById('stopBtn').style.display = 'none';
                document.getElementById('monitoringStatus').textContent = 'Inactive';
                document.getElementById('monitoringStatus').className = 'monitoring-status inactive';
                
                // Stop auto-updating
                clearInterval(updateInterval);
            }
        }
        
        async function updateData() {
            const response = await fetch('/api/data');
            const data = await response.json();
            
            // Update stats
            document.getElementById('totalFiles').textContent = data.stats.total;
            document.getElementById('unchangedFiles').textContent = data.stats.unchanged;
            document.getElementById('modifiedFiles').textContent = data.stats.modified;
            document.getElementById('newFiles').textContent = data.stats.new;
            document.getElementById('deletedFiles').textContent = data.stats.deleted;
            
            // Update file list
            const fileList = document.getElementById('fileList');
            const fileCount = document.getElementById('fileCount');
            fileCount.textContent = data.files.length;
            
            if (data.files.length === 0) {
                fileList.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 40px;">No files to display</p>';
            } else {
                fileList.innerHTML = data.files.map(file => `
                    <div class="file-item ${file.status}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="file-name">${file.name}</div>
                            <span class="status-badge ${file.status}">${file.status}</span>
                        </div>
                        <div class="file-path">${file.path}</div>
                        <div class="file-hash"># ${file.hash}</div>
                        <div class="file-path">Size: ${(file.size / 1024).toFixed(1)} KB</div>
                    </div>
                `).join('');
            }
            
            // Update alerts
            const alertList = document.getElementById('alertList');
            const alertCount = document.getElementById('alertCount');
            alertCount.textContent = data.alerts.length;
            
            if (data.alerts.length === 0) {
                alertList.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 40px;">No alerts yet</p>';
            } else {
                alertList.innerHTML = data.alerts.map(alert => `
                    <div class="alert-item ${alert.type}">
                        <div class="alert-message">${alert.message}</div>
                        ${alert.filepath ? `<div class="file-path">${alert.filepath}</div>` : ''}
                        <div class="alert-time">üïê ${alert.timestamp}</div>
                    </div>
                `).join('');
            }
        }
        
        // Initial data load
        updateData();
        setInterval(updateData, 3000); // Update every 3 seconds
    </script>
</body>
</html>